<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cargar Créditos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f2f2f2; }
    .panel { background: #fff; padding: 20px; border-radius: 8px; width: 300px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input { width: 100%; padding: 8px; margin: 8px 0; box-sizing: border-box; }
    button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #218838; }
    .mensaje { margin-top: 10px; }
  </style>
</head>
<body>

<div class="panel">
  <h2>Cargar Créditos (Fila 2)</h2>
  <input type="number" id="creditos" placeholder="Cantidad de créditos">
  <button onclick="cargarCreditos()">Cargar Créditos</button>
  <div class="mensaje" id="mensaje"></div>
</div>

<script>
async function cargarCreditos() {
  const creditos = Number(document.getElementById("creditos").value);

  if (isNaN(creditos) || creditos <= 0) {
    document.getElementById("mensaje").textContent = "Ingrese una cantidad válida de créditos.";
    return;
  }

  try {
    const res = await fetch("/.netlify/functions/proxy", {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "x-app-secret": "mi_super_secreto" // debe coincidir con netlify.toml
      },
      body: JSON.stringify({ accion: "cargarCreditos", cantidad: creditos })
    });

    const data = await res.json();

    if (data.success) {
      document.getElementById("mensaje").textContent = `Créditos actualizados: ${data.creditosActuales}`;
    } else {
      document.getElementById("mensaje").textContent = `Error: ${data.error}`;
    }
  } catch (error) {
    document.getElementById("mensaje").textContent = `Error de conexión: ${error}`;
  }
}
</script>

</body>
</html>
